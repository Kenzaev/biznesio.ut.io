<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интернет-магазин</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Ваши стили (как в предыдущем коде) */
    </style>
</head>
<body>
    <header>
        <h1>Добро пожаловать в интернет-магазин</h1>
        <input type="text" id="search-bar" placeholder="Поиск..." oninput="filterProducts()" style="padding: 0.5em; width: 80%; max-width: 300px; border-radius: 5px; border: 1px solid #ccc;">
        <button class="admin-button" onclick="openPasswordModal()">Админ</button>
    </header>
    <main>
        <section class="gallery" id="product-gallery">
            <!-- Продукты будут добавлены здесь через JavaScript -->
        </section>
        <section class="cart">
            <h2>Корзина</h2>
            <div id="cart-items"></div>
            <button class="btn" onclick="checkout()">Оформить заказ</button>
            <button class="btn" onclick="showCart()">Посмотреть корзину</button>
        </section>
        <div class="modal" id="passwordModal">
            <div class="modal-content">
                <span class="close" onclick="closePasswordModal()">&times;</span>
                <h2>Введите пароль администратора</h2>
                <input type="password" id="admin-password" placeholder="Пароль">
                <button onclick="checkPassword()">Войти</button>
            </div>
        </div>
        <div class="admin-panel" id="adminPanel">
            <h2>Добавить новый продукт</h2>
            <input type="text" id="product-name" placeholder="Название продукта">
            <input type="number" id="product-price" placeholder="Цена">
            <input type="text" id="product-video" placeholder="Ссылка на видео">
            <input type="text" id="product-image-url" placeholder="Ссылка на изображение"> <!-- Изменено на текстовое поле для URL -->
            <button onclick="addProduct()">Добавить продукт</button>
            <h2>Удалить продукт</h2>
            <input type="number" id="delete-product-id" placeholder="ID продукта">
            <button onclick="deleteProduct()">Удалить продукт</button>
        </div>
    </main>

    <script>
        let cart = [];

        function openPasswordModal() {
            document.getElementById('passwordModal').style.display = 'block';
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
        }

        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === '12345666') { // Замените на ваш реальный пароль
                document.getElementById('adminPanel').style.display = 'block';
                closePasswordModal();
            } else {
                alert('Неверный пароль');
            }
        }

        function filterProducts() {
            const query = document.getElementById('search-bar').value.toLowerCase();
            const products = document.querySelectorAll('.product-card');
            products.forEach(product => {
                const name = product.querySelector('h3').innerText.toLowerCase();
                product.style.display = name.includes(query) ? 'block' : 'none';
            });
        }

        function addProduct() {
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const video = document.getElementById('product-video').value;
            const imageUrl = document.getElementById('product-image-url').value; // Получаем URL изображения

            const productData = {
                name: name,
                price: price,
                video: video,
                image: imageUrl // Используем URL вместо файла
            };

            fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData),
            })
            .then(response => response.json())
            .then(product => {
                displayProduct(product);
                document.getElementById('product-name').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-video').value = '';
                document.getElementById('product-image-url').value = ''; // Сбрасываем поле URL
            })
            .catch(error => console.error('Ошибка:', error));
        }

        function displayProduct(product) {
            const gallery = document.getElementById('product-gallery');
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${product.image}" alt="${product.name}">
                <h3>${product.name}</h3>
                <p>Цена: ${product.price} ₽</p>
                <button onclick="addToCart(${product.id}, '${product.name}', ${product.price}, '${product.image}')">Добавить в корзину</button>
            `;
            gallery.appendChild(card);
        }

        function addToCart(id, name, price, image) {
            cart.push({ id, name, price, image });
            alert(`${name} добавлен в корзину`);
        }

        function showCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    ${item.name} - ${item.price} ₽
                    <button onclick="removeFromCart(${item.id})">Удалить</button>
                `;
                cartItems.appendChild(cartItem);
            });
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            showCart();
        }

        function checkout() {
            alert('Спасибо за покупку!');
            cart = [];
            showCart();
        }

        function deleteProduct() {
            const id = document.getElementById('delete-product-id').value;
            fetch(`/api/products/${id}`, {
                method: 'DELETE',
            })
            .then(() => {
                alert('Продукт удален');
                location.reload(); // Обновить страницу
            })
            .catch(error => console.error('Ошибка:', error));
        }

        // Загрузка продуктов при загрузке страницы
        window.onload = function() {
            fetch('/api/products')
                .then(response => response.json())
                .then(products => {
                    products.forEach(displayProduct);
                })
                .catch(error => console.error('Ошибка:', error));
        };
    </script>
</body>
</html>
